<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>åœ‹æ–‡ä¹å¼ãƒ»é™é­”ä¿®ç…‰è·¯ V3</title>
    
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;700;900&family=Zen+Maru+Gothic:wght@500;700&display=swap');
        
        body {
            font-family: 'Zen Maru Gothic', sans-serif;
            background-color: #111;
            color: #eee;
            overscroll-behavior: none;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        /* --- è¦–è¦ºç‰¹æ•ˆç³»çµ± (CSS Animation) --- */
        
        /* ç•«é¢éœ‡å‹• (å—å‚·æ™‚) */
        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            10% { transform: translate(-1px, -2px) rotate(-1deg); }
            20% { transform: translate(-3px, 0px) rotate(1deg); }
            30% { transform: translate(3px, 2px) rotate(0deg); }
            40% { transform: translate(1px, -1px) rotate(1deg); }
            50% { transform: translate(-1px, 2px) rotate(-1deg); }
            60% { transform: translate(-3px, 1px) rotate(0deg); }
            100% { transform: translate(0, 0) rotate(0deg); }
        }
        .shake-effect { animation: shake 0.5s; border: 2px solid #ef4444; }

        /* å‚·å®³é£„å­— */
        @keyframes float-up {
            0% { opacity: 1; transform: translateY(0) scale(1); }
            100% { opacity: 0; transform: translateY(-50px) scale(1.5); }
        }
        .damage-number {
            position: absolute;
            color: #ef4444;
            font-size: 4rem;
            font-weight: 900;
            text-shadow: 2px 2px 0 #fff;
            animation: float-up 0.8s ease-out forwards;
            z-index: 50;
            pointer-events: none;
        }

        /* æ€ªç‰©å‘¼å¸å‹•ç•« */
        @keyframes breath {
            0% { transform: scale(1); filter: brightness(1); }
            50% { transform: scale(1.05); filter: brightness(1.2); }
            100% { transform: scale(1); filter: brightness(1); }
        }
        .monster-anim { animation: breath 3s infinite ease-in-out; }

        /* æ€ªç‰©å—å‚·é–ƒçˆ */
        .monster-hurt {
            filter: sepia(1) saturate(5) hue-rotate(-50deg) brightness(1.5) !important;
            transform: scale(0.9) !important;
            transition: all 0.1s;
        }

        /* é‡é»é«˜äº®ç­†è§¸ */
        .highlight-mark {
            background: linear-gradient(120deg, #84cc16 0%, #10b981 100%);
            color: #000;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: bold;
            box-shadow: 0 0 10px rgba(16, 185, 129, 0.5);
            display: inline-block;
            transform: skew(-5deg);
        }

        /* åˆªé™¤ç·šç‰¹æ•ˆ */
        .dim-mark {
            color: #666;
            text-decoration: line-through;
            font-size: 0.9em;
            transition: all 0.5s;
        }

        /* æ–·å¥åˆ€ç—• */
        .cut-mark {
            display: inline-block;
            width: 4px;
            height: 1.5em;
            background-color: #ef4444;
            margin: 0 4px;
            vertical-align: middle;
            box-shadow: 0 0 8px #ef4444;
            transform: rotate(15deg);
            animation: pulse 0.5s infinite;
        }
    </style>
</head>
<body class="h-screen w-screen overflow-hidden flex flex-col">
    <div id="root" class="h-full w-full max-w-lg mx-auto flex flex-col relative bg-gray-900 shadow-2xl"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- å…§åµŒ SVG åœ–æ¨™ (é˜²æ­¢åœ–æ¨™åº«è¼‰å…¥å¤±æ•—) ---
        const Icons = {
            Sword: () => <svg className="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14.5 17.5L3 6V3h3l11.5 11.5"/><path d="m13 19 6-6"/><path d="M16 16l4 4"/><path d="M19 21l2-2"/></svg>,
            Shield: () => <svg className="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>,
            Eye: () => <svg className="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></svg>,
            Zap: () => <svg className="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>,
            Heart: ({ filled }) => <svg className={`w-6 h-6 ${filled ? 'fill-red-500 text-red-500' : 'text-gray-600'}`} viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></svg>,
            Skull: () => <svg className="w-12 h-12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="9" cy="12" r="1"/><circle cx="15" cy="12" r="1"/><path d="M8 20v2h8v-2"/><path d="m12.5 17-.5-1-.5 1h1z"/><path d="M16 20a2 2 0 0 0 1.56-3.25 8 8 0 1 0-11.12 0A2 2 0 0 0 8 20"/></svg>
        };

        // --- å®Œæ•´é¡Œç›®è³‡æ–™åº« ---
        const LEVELS = [
            {
                id: 1,
                name: "ç¬¬ä¸€é—œï¼šè¿·éœ§æ£®æ—",
                skill: "æ…§çœ¼",
                desc: "å¿…å‹ç¬¬ä¸€å¼ï¼šç¯‡åå‘¼æ‡‰ã€‚å…ˆçœ‹ç¯‡åï¼Œé æ¸¬ä¸»æ—¨ï¼",
                icon: <Icons.Eye />,
                color: "text-emerald-400",
                enemies: [
                    {
                        name: "èŒ¶é¦™éœ§å¦–",
                        type: "å°æ€ª",
                        hp: 100,
                        source: "109å¹´æœƒè€ƒ Q33",
                        title: "ã€ˆå–èŒ¶åŠ ä¸åŠ ç³–ï¼ŒåŸä¾†å’Œéšç´šæœ‰é—œã€‰",
                        content: "å–èŒ¶åŠ æª¸æª¬æ˜¯ç¾å¼ä½œæ³•ï¼Œè‹±åœ‹äººå‰‡ä¸ç„¶ã€‚æ—©æœŸé–‹å§‹æµè¡ŒèŒ¶è‘‰æ™‚ï¼Œè‹±åœ‹äººæ¨¡ä»¿ä¸­åœ‹äººä½¿ç”¨ç“·å…·æ³¡èŒ¶ï¼Œä½†è‹¥ç›´æ¥å€’å…¥ç†±èŒ¶å¯èƒ½å°è‡´ç“·æ¯éç†±ç ´è£‚ï¼Œæ•…å…ˆåŠ å…¥ç‰›å¥¶ä¾†é™æº«ã€‚ç•¶æ™‚çš„ä¸Šæµç¤¾æœƒä¹Ÿå› æ­¤æœƒæ¯”è¼ƒå½¼æ­¤çš„ç“·å™¨ç­‰ç´šï¼Œè‹¥èŒ¶å…·èƒ½æ¥å—ç‰›å¥¶å¾ŒåŠ ï¼Œè¡¨ç¤ºæ­¤å®¶æ—æ“æœ‰çš„èŒ¶å…·ç­‰ç´šæ›´é«˜ã€‚ä¸­ä¸Šéšç´šçš„å–èŒ¶ç¿’æ…£ï¼Œæ˜¯å…ˆç”¨èŒ¶å£ºæµ¸æ³¡èŒ¶è‘‰ï¼Œå½¢æˆæ·¡èŒ¶å¾Œå†å€’å…¥å–®è€³ç“·æ¯è£¡ã€‚é€šå¸¸ä¼¯çˆµèŒ¶ã€çƒé¾èŒ¶æ˜¯ä¸Šæµç¤¾æœƒè£¡å¸¸è¦‹çš„èŒ¶å“ï¼ŒèŒ¶è‰²å‘ˆæ·¡è¤è‰²ï¼ŒåŠ å…¥ç‰›å¥¶é£²ç”¨ï¼Œå› ç‚ºå¤šæœƒæ­é…ç”œå“ï¼Œé€šå¸¸ä¸æœƒåŠ ç³–ã€‚è€Œå‹å‹•éšç´šçš„é£²èŒ¶æ–¹å¼ï¼Œå‰‡æ˜¯ä»¥èŒ¶åŒ…æ²–æ³¡æ–¼é¦¬å…‹æ¯ä¸­å½¢æˆæ¿ƒèŒ¶å¾Œå†åŠ å…¥ç³–ï¼Œç‰›å¥¶å‰‡å¯èåˆæ¿ƒèŒ¶çš„è‹¦æ¾€å‘³ï¼Œæ—¢æ¿ƒåˆç”œçš„é˜¿è–©å§†æ•…è€Œæˆç‚ºå—æ­¡è¿çš„èŒ¶ï¼Œæ˜¯éœ€è¦æ¶ˆè€—å¤§é‡ç†±é‡çš„å‹å·¥éšç´šå–œæ„›çš„å£å‘³ã€‚",
                        skillTarget: ["å‹å‹•éšç´š", "é¦¬å…‹æ¯", "æ¿ƒèŒ¶", "åŠ å…¥ç³–"],
                        preQuestion: "æ ¹æ“šç¯‡åï¼Œé€™ç¯‡æ–‡ç« çš„ä¸»æ—¨æ˜¯ä»€éº¼ï¼Ÿ",
                        preOptions: ["èŒ¶è‘‰ç¨®æ¤æŠ€è¡“", "éšç´šèˆ‡å–èŒ¶ç¿’æ…£"],
                        preAnswer: 1,
                        finalQuestion: "æ ¹æ“šæœ¬æ–‡ï¼Œæ˜”æ—¥è‹±åœ‹ã€Œå‹å‹•éšç´šã€çš„å–èŒ¶æ–¹å¼ç‚ºä½•ï¼Ÿ",
                        options: ["ç“·å™¨ã€æ·¡èŒ¶ã€ä¸åŠ ç³–", "é¦¬å…‹æ¯ã€æ¿ƒèŒ¶ã€åŠ ç³–", "ç“·å™¨ã€æ¿ƒèŒ¶ã€åŠ ç³–", "é¦¬å…‹æ¯ã€æ·¡èŒ¶ã€ä¸åŠ ç³–"],
                        answer: 1
                    },
                    {
                        name: "å›æ†¶æ¨¹ç²¾",
                        type: "èè‹±",
                        hp: 200,
                        source: "105å¹´æœƒè€ƒ Q42",
                        title: "å‘é™½ã€ˆå°æ²³ã€‰",
                        content: "å°æ²³å‘¢ï¼Ÿé‚£å¿µå¿µä¸å¿˜çš„å°æ²³ã€‚ä¾†åˆ°æ²³åŸ”çš„æ™‚å€™ï¼Œå·²åˆæ™‚åˆ†ã€‚æ²’ä¾†ç”±åœ°ï¼Œå››é‚Šé™°æš—äº†ä¸‹ä¾†ï¼Œæˆ‘æŠ¬é ­ï¼Œä¸€å¤§å¡Šçƒé›²æ­£æ…¢æ…¢åœéä¾†ã€‚å‰›å‰›é‚„æ˜¯è±”é™½å¤©ï¼Œä¸€ä¸‹å­å°±å±±é›¨æ¬²ä¾†æ¨¡æ¨£ã€‚è€Œä»¤æˆ‘çœŸæ­£é©šæ‚¸çš„ï¼Œé‚„æ˜¯å°æ²³ã€‚ä¹¾ç™Ÿã€ç˜¦å‰Šï¼Œè€Œä¸”çœ‹ä¾†ç—›è‹¦ã€‚ä¸€æ¢ç˜¦éª¨å¶™å³‹çš„æ²³åºŠï¼å‰æ–¹æ˜¯å¯ä»¥æŒ‡èªå‡ºä¾†çš„æ´—è¡£çŸ³ï¼Œä¸Šé¢çˆ¬æ»¿äº†æ‰­æ›²è€Œçƒé¬±çš„è‹”è˜š...å†éä¾†çš„çŸ³é ­ä¸Šï¼Œæ›¾ç¶“æ˜¯ä»°æœ›è—å¤©çš„å‡å¯è™•ï¼Œå †ç©è‘—ç ´éŠ…çˆ›éµï¼Œç´™å¼µåƒåœ¾ï¼Œæ²’æœ‰æ²³æ°´ï¼Œè‡ªç„¶æ²’æœ‰é­šè¦...é€™æ¨£ä¸€æ¢å°æ²³ï¼é‚£æ›¾ç¶“å¿µå¿µä¸å¿˜çš„å°æ²³ï¼Ÿ",
                        skillTarget: ["ä¹¾ç™Ÿã€ç˜¦å‰Š", "ç—›è‹¦", "å †ç©è‘—ç ´éŠ…çˆ›éµ"],
                        preQuestion: "å¾ç¯‡åèˆ‡å…§æ–‡åˆ¤æ–·ï¼Œä¸»è§’æ˜¯ï¼Ÿ",
                        preOptions: ["æŸå€‹äºº", "ä¸€æ¢æ²³"],
                        preAnswer: 1,
                        finalQuestion: "æ–‡ä¸­ç•«ç·šè™•ã€ä¹¾ç™Ÿã€ç˜¦å‰Šã€éš±å«ä½œè€…ä»€éº¼å¿ƒæƒ…ï¼Ÿ",
                        options: ["é©šæ„•èˆ‡å¤±è½", "æ†¤æ€’èˆ‡ä»‡æ¨", "å¹³éœèˆ‡æ¥ç´", "èˆˆå¥®èˆ‡æœŸå¾…"],
                        answer: 0
                    }
                ]
            },
            {
                id: 2,
                name: "ç¬¬äºŒé—œï¼šæ–·å¥å³½è°·",
                skill: "æ–·å¥åˆ€",
                desc: "å¿…å‹ç¬¬äºŒå¼ï¼šæ¨™é»æ–·å¥ã€‚æ–¬æ–·é•·å¥ï¼Œæ‰¾å‡ºèªæ°£ï¼",
                icon: <Icons.Sword />,
                color: "text-red-400",
                enemies: [
                    {
                        name: "é•·å¥å·¨èŸ’",
                        type: "èè‹±",
                        hp: 150,
                        source: "111å¹´æœƒè€ƒ Q7",
                        title: "è¨˜æ†¶èˆ‡æ•˜è¿°",
                        content: "æ•˜è¿°è¨˜æ†¶æ˜¯ä»¶é›£äº‹ã€‚è¨˜æ†¶æ˜¯ä¸€å€‹æ•´é«”ï¼Œæ•˜è¿°çš„æ™‚å€™å¿…é ˆé¸æ“‡å°‡å®ƒä¸€ç‰‡ç‰‡çš„åˆ‡ä¸‹ï¼Œå³ä½¿æ˜¯ä¸€å¡Šè‚‰ã€ä¸€æ£µèœç”²åˆ‡ä¸‹ä¾†å¾Œå°±å†ä¹Ÿæ‹¼ä¸å®Œæ•´äº†ï¼Œå°±ç®—æ‹¼æ¹Šèµ·ä¾†äº†ä¹™ä¹Ÿåªç®—æ˜¯æ­»çš„æ¨™æœ¬ï¼Œç”Ÿå‘½å·²è•©ç„¶ä¸™ä½•æ³è¨˜æ†¶å¤§éƒ¨åˆ†çš„æ™‚å€™æ›´åƒä¸€é™£é¢¨ï¼Œä¾†ç„¡å½±å»ç„¡è¹¤çš„ï¼Œè¦æƒ³å°‡é¢¨ç‰‡åˆ‡ä¸‹ä¾†ï¼Œè±ˆä¸å®Œå…¨æ˜¯ä¸€å ´å¾’å‹å—ä¸",
                        skillTarget: "ä¸",
                        preQuestion: "ã€Œè±ˆä¸å®Œå…¨æ˜¯ä¸€å ´å¾’å‹å—ã€é€™æ˜¯ä»€éº¼èªæ°£ï¼Ÿ",
                        preOptions: ["è‚¯å®šå¥ (ã€‚)", "åå•å¥ (?)"],
                        preAnswer: 1,
                        finalQuestion: "æ–‡ä¸­ç”²ä¹™ä¸™ä¸ä½•è™•æœ€é©åˆå¡«å…¥ã€å¥è™Ÿã€ï¼Ÿ",
                        options: ["ç”²", "ä¹™", "ä¸™", "ä¸"],
                        answer: 3
                    },
                    {
                        name: "é›™é ­çµäºº",
                        type: "BOSS",
                        hp: 300,
                        source: "106å¹´æœƒè€ƒ Q35",
                        title: "çµäººèˆ‡è¾²å¤«",
                        content: "æœ‰äº›ç§‘å­¸å®¶æå‡ºã€Œçµäººèˆ‡è¾²å¤«ã€çš„ç†è«–ï¼Œèªç‚ºADHDè€…(æ³¨æ„åŠ›ç¼ºå¤±çš„éå‹•å…’)å…¶å¯¦æ²’æœ‰æ¯›ç—…ï¼Œåªæ˜¯ç”ŸéŒ¯äº†æ™‚ç©ºã€‚ç¾åœ¨æ‰€è¬‚æ³¨æ„åŠ›ç¼ºå¤±è€…çš„ç‰¹å¾µâ€”â€”å®¹æ˜“åˆ†å¿ƒã€è¡å‹•ã€å†’éšªæ€§å¼·ï¼Œå…¶å¯¦æ˜¯é å¤æ‰“çµæ¡é›†æ™‚ç”Ÿå­˜å¿…è¦çš„ç‰¹å¾µã€‚ç•¶äººé¡é€²åŒ–åˆ°è¾²æ¥­ç¤¾æœƒä»¥å¾Œï¼Œé€™äº›ç‰¹å¾µæ‰è®Šå¾—æ ¼æ ¼ä¸å…¥ã€‚ä¹Ÿå°±æ˜¯èªªï¼Œä»–å€‘æ˜¯ã€Œçµäººã€ï¼Œä½†æ˜¯è¦åœ¨ã€Œè¾²å¤«ã€çš„ç¤¾æœƒè£¡è¨ç”Ÿæ´»ï¼Œå¾€å¾€æœƒè¢«è¦–ç‚ºç•°é¡ã€‚",
                        skillTarget: ["â€”â€”", "ç‰¹å¾µ"],
                        preQuestion: "æ–‡ä¸­çš„ç ´æŠ˜è™Ÿ (â€”â€”) åŠŸèƒ½æ˜¯ä»€éº¼ï¼Ÿ",
                        preOptions: ["è²éŸ³å»¶é•·", "è§£é‡‹èªªæ˜"],
                        preAnswer: 1,
                        finalQuestion: "ä½œè€…å°ADHDè€…çš„æ ¸å¿ƒçœ‹æ³•ç‚ºä½•ï¼Ÿ",
                        options: ["æ‡‰æ¥å—è—¥ç‰©æ²»ç™‚", "ä¸å®œä»¥ç•°é¡çœ¼å…‰çœ‹å¾…", "åŸºå› æ¯”å¸¸äººå„ªç§€", "æ˜¯ç¤¾æœƒç™¼å±•çš„è² æ“”"],
                        answer: 1
                    }
                ]
            },
            {
                id: 3,
                name: "ç¬¬ä¸‰é—œï¼šé‚è¼¯è¿·å®®",
                skill: "è½‰æŠ˜ç›¾",
                desc: "å¿…å‹ç¬¬ä¸‰å¼ï¼šé‚è¼¯å­—è©ã€‚æ“‹æ‰å»¢è©±ï¼Œç•™ä¸‹é‡é»ï¼",
                icon: <Icons.Shield />,
                color: "text-blue-400",
                enemies: [
                    {
                        name: "æ²¸æ°´æ€ª",
                        type: "å°æ€ª",
                        hp: 120,
                        source: "105å¹´æœƒè€ƒ Q31",
                        title: "æšæ¹¯æ­¢æ²¸",
                        content: "å¤«æŠ•è† ä»¥è®Šæ¿ï¼Œä¸å¦‚æ¾„å…¶æºè€Œæ¿è®Šä¹‹æ„ˆä¹Ÿï¼›æšæ¹¯ä»¥æ­¢æ²¸ï¼Œä¸å¦‚çµ•å…¶è–ªè€Œæ²¸æ­¢ä¹‹é€Ÿä¹Ÿã€‚æ˜¯ä»¥å‹å¿ƒæ–¼æœé è€…ï¼Œè«è‹¥ä¿®è¿‘è€Œå…¶é è‡ªä¾†ï¼›å¤šæ–¹ä»¥æ•‘å¤±è€…ï¼Œè«è‹¥æ”¹è¡Œè€Œå…¶å¤±è‡ªå»ã€‚",
                        skillTarget: ["æšæ¹¯ä»¥æ­¢æ²¸", "ä¸å¦‚", "çµ•å…¶è–ª"],
                        preQuestion: "ã€Œä¸å¦‚ã€å‡ºç¾æ™‚ï¼Œé‡é»åœ¨å‰é¢é‚„æ˜¯å¾Œé¢ï¼Ÿ",
                        preOptions: ["å‰é¢ (æšæ¹¯æ­¢æ²¸)", "å¾Œé¢ (çµ•è–ª)"],
                        preAnswer: 1,
                        finalQuestion: "ä¸‹åˆ—ä½•è€…æœ€ç¬¦åˆä½œè€…ã€Œæ²»æœ¬ã€çš„è§€é»ï¼Ÿ",
                        options: ["æšæ¹¯æ­¢æ²¸", "æŠ•è† è®Šæ¿", "çµ•è–ªæ­¢æ²¸", "å¤šæ–¹æ•‘å¤±"],
                        answer: 2
                    },
                    {
                        name: "æ·±å½é­”ç‹",
                        type: "BOSS",
                        hp: 400,
                        source: "113å¹´æœƒè€ƒ Q35",
                        title: "æ·±å½æŠ€è¡“",
                        content: "æ·±å½æŠ€è¡“èƒ½è£½ä½œçš„é™¤äº†å½±åƒï¼Œä¹ŸåŒ…æ‹¬æ–‡å­—èˆ‡è²éŸ³...æ·±å½æŠ€è¡“æ˜¯è¿‘å¹´æ–°èˆˆçš„ç§‘æŠ€ï¼Œè‹¥å°‡å®ƒé‹ç”¨æ–¼å½±è¦–ä½œå“ï¼Œå¯ç¯€çœè£½ä½œé›»å½±æˆ–éŠæˆ²çš„æ™‚é–“ï¼Œæœ‰æ­£é¢çš„æ•ˆç›Šã€‚ä½†ä¹Ÿæœ‰äººåˆ©ç”¨åˆæˆçš„å‡å½±åƒæ“å¼„è³‡è¨Šï¼Œé€²è€Œè©é¨™ç‰Ÿåˆ©ã€æ¯€äººè²è­½ï¼Œè£½é€ ç¤¾æœƒçš„å‹•ç›ªï¼Œè®“é€™é …æŠ€è¡“å¼•ç™¼çˆ­è­°ã€‚",
                        skillTarget: ["æœ‰æ­£é¢çš„æ•ˆç›Š", "ä½†", "è² é¢çˆ­è­°"],
                        preQuestion: "ä½œè€…ç”¨ã€Œä½†ã€å­—è½‰æŠ˜ï¼ŒçœŸæ­£æƒ³å¼·èª¿çš„æ˜¯ï¼Ÿ",
                        preOptions: ["æ­£é¢æ•ˆç›Š", "è² é¢çˆ­è­°"],
                        preAnswer: 1,
                        finalQuestion: "æ ¹æ“šæœ¬æ–‡ï¼Œæ·±å½æŠ€è¡“æœ€å¤§çš„éš±æ†‚æ˜¯ä»€éº¼ï¼Ÿ",
                        options: ["è£½ä½œæˆæœ¬éé«˜", "å–ä»£æ¼”å“¡å·¥ä½œ", "é€ æˆæ°‘çœ¾å°ç¤¾æœƒçš„ä¸ä¿¡ä»»", "æŠ€è¡“é–€æª»å¤ªä½"],
                        answer: 2
                    }
                ]
            }
        ];

        // --- æ€ªç‰©è¦–è¦ºçµ„ä»¶ (CSS Art - è§£æ±ºä¸åƒå¦–æ€ªçš„å•é¡Œ) ---
        const MonsterVisual = ({ type, isHit }) => {
            const hitClass = isHit ? 'monster-hurt' : 'monster-anim';
            
            if (type === "å°æ€ª") {
                // éœ§å¦–/å²èŠå§†ï¼šä¸å®šå½¢çš„å…‰æšˆç”Ÿç‰©
                return (
                    <div className={`relative w-32 h-32 flex items-center justify-center ${hitClass}`}>
                        <div className="absolute inset-0 bg-gradient-to-tr from-green-400 to-teal-600 rounded-full blur-xl opacity-60"></div>
                        <div className="relative w-24 h-24 bg-gray-800 rounded-full border-4 border-green-400 flex items-center justify-center overflow-hidden">
                            <div className="w-16 h-16 bg-green-500 rounded-full blur-md opacity-50 absolute animate-pulse"></div>
                            <span className="text-5xl relative z-10">ğŸ¦ </span>
                        </div>
                    </div>
                );
            } else if (type === "èè‹±") {
                // æ¨¹ç²¾/å·¨èŸ’ï¼šæœ‰ç¨œè§’çš„å‹•æ…‹ç”Ÿç‰©
                return (
                    <div className={`relative w-40 h-40 flex items-center justify-center ${hitClass}`}>
                        <div className="absolute w-full h-full border-4 border-dashed border-purple-500 rounded-full animate-[spin_10s_linear_infinite]"></div>
                        <div className="relative w-28 h-28 bg-gray-800 rotate-45 border-4 border-purple-400 flex items-center justify-center shadow-[0_0_20px_purple]">
                            <span className="text-6xl -rotate-45">ğŸ</span>
                        </div>
                    </div>
                );
            } else {
                // BOSSï¼šéœ¸æ°£çš„å¹¾ä½•é­”ç‹
                return (
                    <div className={`relative w-48 h-48 flex items-center justify-center ${hitClass}`}>
                        <div className="absolute w-full h-full bg-red-900 rounded-full blur-xl opacity-50 animate-pulse"></div>
                        <div className="absolute w-44 h-44 border-8 border-double border-red-600 rounded-full"></div>
                        <div className="relative w-36 h-36 bg-gray-900 border-2 border-red-500 rounded-full flex items-center justify-center overflow-hidden shadow-[inset_0_0_30px_#991b1b]">
                            <span className="text-8xl drop-shadow-[0_0_15px_red]">ğŸ‘¹</span>
                        </div>
                    </div>
                );
            }
        };

        // --- éŠæˆ²é‚è¼¯ ---
        const Game = () => {
            const [gameState, setGameState] = useState("menu");
            const [levelIdx, setLevelIdx] = useState(0);
            const [enemyIdx, setEnemyIdx] = useState(0);
            const [hp, setHp] = useState(3);
            const [enemyHp, setEnemyHp] = useState(100);
            const [phase, setPhase] = useState("intro"); 
            const [isHit, setIsHit] = useState(false);
            const [damage, setDamage] = useState(null);
            const [isShaking, setIsShaking] = useState(false);
            const [processedText, setProcessedText] = useState("");
            const [feedback, setFeedback] = useState("");

            const currentLevel = LEVELS[levelIdx];
            const currentEnemy = currentLevel.enemies[enemyIdx];

            // åˆå§‹åŒ–å›åˆ
            useEffect(() => {
                if (gameState === "battle") {
                    setEnemyHp(currentEnemy.hp);
                    setProcessedText(currentEnemy.content);
                    setPhase("intro");
                    setFeedback("");
                }
            }, [levelIdx, enemyIdx, gameState]);

            const triggerShake = () => {
                setIsShaking(true);
                setTimeout(() => setIsShaking(false), 500);
            };

            const showDamage = (val) => {
                setDamage(val);
                setIsHit(true);
                setTimeout(() => {
                    setDamage(null);
                    setIsHit(false);
                }, 800);
            };

            const handleSkill = (optIdx) => {
                if (optIdx === currentEnemy.preAnswer) {
                    // æŠ€èƒ½æˆåŠŸ
                    showDamage("ç ´é˜²!");
                    setFeedback("âœ… æŠ€èƒ½ç™¼å‹•æˆåŠŸï¼ç ´ç¶»å·²ç¾ï¼");
                    
                    // æ–‡å­—ç‰¹æ•ˆè™•ç†
                    let newText = currentEnemy.content;
                    const targets = Array.isArray(currentEnemy.skillTarget) ? currentEnemy.skillTarget : [currentEnemy.skillTarget];
                    
                    if (currentLevel.id === 2) { // æ–·å¥ï¼šåˆ‡é–‹
                        const target = targets[0];
                        const parts = newText.split(target);
                        newText = parts.join(`<span class="cut-mark"></span><span class="text-red-400 font-bold text-xl">${target}</span>`);
                    } else if (currentLevel.id === 3) { // è½‰æŠ˜ï¼šåˆªé™¤ç·š
                        targets.forEach(t => {
                            newText = newText.replace(new RegExp(t, 'g'), `<span class="dim-mark">${t}</span>`);
                        });
                    } else { // æ…§çœ¼ï¼šè¢å…‰ç­†
                        targets.forEach(t => {
                            newText = newText.replace(new RegExp(t, 'g'), `<span class="highlight-mark">${t}</span>`);
                        });
                    }
                    
                    setProcessedText(newText);
                    setTimeout(() => {
                        setPhase("attack");
                        setFeedback("");
                    }, 1200);
                } else {
                    // æŠ€èƒ½å¤±æ•—
                    triggerShake();
                    setHp(prev => prev - 1);
                    setFeedback("âŒ åˆ¤æ–·éŒ¯èª¤ï¼å—åˆ°åæ“Šï¼");
                    if (hp <= 1) setTimeout(() => setGameState("lose"), 1000);
                }
            };

            const handleAttack = (optIdx) => {
                if (optIdx === currentEnemy.answer) {
                    // æ”»æ“ŠæˆåŠŸ
                    const dmg = currentEnemy.hp;
                    showDamage("-" + dmg);
                    setEnemyHp(0);
                    setFeedback("âš”ï¸ æœƒå¿ƒä¸€æ“Šï¼");
                    
                    setTimeout(() => {
                        if (enemyIdx < currentLevel.enemies.length - 1) {
                            setEnemyIdx(prev => prev + 1);
                        } else if (levelIdx < LEVELS.length - 1) {
                            setLevelIdx(prev => prev + 1);
                            setEnemyIdx(0);
                        } else {
                            setGameState("win");
                        }
                    }, 1500);
                } else {
                    // æ”»æ“Šå¤±æ•—
                    triggerShake();
                    setHp(prev => prev - 1);
                    setFeedback("ğŸ›¡ï¸ æ”»æ“Šè¢«æ ¼æ“‹äº†ï¼");
                    if (hp <= 1) setTimeout(() => setGameState("lose"), 1000);
                }
            };

            // --- ç•«é¢æ¸²æŸ“ ---

            if (gameState === "menu") return (
                <div className="h-full flex flex-col items-center justify-center p-6 text-center space-y-8 bg-gray-900">
                    <div className="space-y-2">
                        <div className="text-yellow-500 font-bold tracking-widest text-lg">æœƒè€ƒåœ‹æ–‡ç‰¹è¨“</div>
                        <h1 className="text-6xl font-black text-white drop-shadow-[0_0_10px_rgba(255,255,255,0.5)]">åœ‹æ–‡ä¹å¼</h1>
                        <h2 className="text-4xl font-bold text-red-500 drop-shadow-[0_0_10px_red]">é™é­”ä¿®ç…‰è·¯</h2>
                    </div>
                    <div className="grid grid-cols-1 gap-3 w-full max-w-sm">
                        {LEVELS.map((l, i) => (
                            <div key={i} className="bg-gray-800 p-3 rounded border border-gray-600 flex items-center gap-3">
                                <div className="text-yellow-400">{l.icon}</div>
                                <div className="text-left">
                                    <div className="font-bold text-white">{l.name.split("ï¼š")[1]}</div>
                                    <div className="text-xs text-gray-400">{l.skill}</div>
                                </div>
                            </div>
                        ))}
                    </div>
                    <button onClick={() => setGameState("battle")} className="w-full max-w-sm bg-red-600 hover:bg-red-500 text-white text-2xl font-bold py-4 rounded-xl shadow-[0_4px_0_#991b1b] active:translate-y-1 active:shadow-none transition-all flex items-center justify-center gap-2">
                        <Icons.Zap /> é–‹å§‹ä¿®ç…‰
                    </button>
                </div>
            );

            if (gameState === "win") return (
                <div className="h-full flex flex-col items-center justify-center bg-yellow-900/90 text-white p-6 text-center">
                    <div className="text-9xl mb-4 animate-bounce">ğŸ†</div>
                    <h1 className="text-5xl font-bold mb-4">ä¿®ç…‰å®Œæˆï¼</h1>
                    <p className="text-xl mb-8">æ­å–œå¤§ä¿ ï¼ä½ å·²æŒæ¡åœ‹æ–‡è§£é¡Œå¥§ç¾©ï¼</p>
                    <button onClick={() => location.reload()} className="bg-yellow-500 text-black px-8 py-3 rounded-full font-bold text-xl shadow-lg hover:scale-105 transition-transform">å†ä¾†ä¸€å±€</button>
                </div>
            );

            if (gameState === "lose") return (
                <div className="h-full flex flex-col items-center justify-center bg-gray-900 text-white p-6 text-center">
                    <div className="text-8xl mb-4 text-gray-500"><Icons.Skull /></div>
                    <h1 className="text-5xl font-bold mb-4 text-red-500">ä¿®ç…‰å¤±æ•—</h1>
                    <p className="text-xl mb-8 text-gray-400">å‹æ•—ä¹ƒå…µå®¶å¸¸äº‹ï¼Œå¤§ä¿ è«‹é‡æ–°ä¾†éã€‚</p>
                    <button onClick={() => location.reload()} className="bg-gray-700 px-8 py-3 rounded-full font-bold text-xl border border-gray-500 hover:bg-gray-600">é‡æ–°æŒ‘æˆ°</button>
                </div>
            );

            // æˆ°é¬¥ç•«é¢
            return (
                <div className={`h-full flex flex-col relative ${isShaking ? 'shake-effect' : ''}`}>
                    {/* é ‚éƒ¨è³‡è¨Šåˆ— */}
                    <div className="p-3 bg-gray-800 flex justify-between items-center border-b border-gray-700 shadow-md z-20">
                        <div className="flex gap-1 items-center">
                            <span className="text-xs font-bold text-gray-500 mr-1">HP</span>
                            {[...Array(3)].map((_, i) => (
                                <Icons.Heart key={i} filled={i < hp} />
                            ))}
                        </div>
                        <div className={`font-bold text-lg ${currentLevel.color}`}>{currentLevel.name}</div>
                    </div>

                    {/* æ€ªç‰©æˆ°é¬¥å€ */}
                    <div className="flex-1 bg-gray-900 relative flex flex-col items-center justify-center p-4 overflow-hidden">
                        {/* èƒŒæ™¯è£é£¾ */}
                        <div className="absolute inset-0 opacity-10 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-gray-700 via-gray-900 to-black"></div>
                        
                        {/* å‚·å®³æ•¸å­— */}
                        {damage && <div className="damage-number top-1/3">{damage}</div>}

                        {/* æ€ªç‰©æœ¬é«” */}
                        <div className="relative z-10 mb-6 transition-all duration-300">
                            <MonsterVisual type={currentEnemy.type} isHit={isHit} />
                        </div>

                        {/* è¡€æ¢èˆ‡åç¨± */}
                        <div className="w-64 h-4 bg-gray-800 rounded-full border border-gray-600 overflow-hidden shadow-inner relative z-10">
                            <div className="h-full bg-gradient-to-r from-red-600 to-red-400 transition-all duration-500" style={{width: `${(enemyHp / currentEnemy.hp) * 100}%`}}></div>
                        </div>
                        <div className="mt-2 font-bold text-gray-400 text-sm z-10">{currentEnemy.name} <span className="text-xs bg-gray-800 px-1 rounded border border-gray-700">{currentEnemy.type}</span></div>
                    </div>

                    {/* æ–‡æœ¬èˆ‡äº’å‹•å€ (å·è»¸é¢¨æ ¼) */}
                    <div className="bg-[#1a1a1a] border-t-4 border-yellow-700 flex flex-col h-[55%] shadow-[0_-5px_20px_rgba(0,0,0,0.8)] z-20">
                        
                        {/* é¡Œç›®å·è»¸ */}
                        <div className="flex-1 overflow-y-auto p-4 custom-scrollbar">
                            <div className="bg-[#2a2a2a] p-4 rounded-lg border border-gray-600 shadow-inner">
                                <div className="flex justify-between items-center mb-2 border-b border-gray-600 pb-2">
                                    <span className="text-yellow-500 font-bold text-sm">ğŸ“œ {currentEnemy.title}</span>
                                    <span className="text-xs text-gray-500 bg-black px-2 py-1 rounded">{currentEnemy.source}</span>
                                </div>
                                <div className="text-lg leading-loose text-gray-300 text-justify" dangerouslySetInnerHTML={{__html: processedText}}></div>
                            </div>
                        </div>

                        {/* æ“ä½œé¢æ¿ */}
                        <div className="p-3 bg-gray-800 border-t border-gray-700">
                            {feedback && (
                                <div className="absolute top-[-60px] left-1/2 transform -translate-x-1/2 bg-black/90 text-white px-6 py-2 rounded-full border border-yellow-500 font-bold animate-bounce shadow-lg whitespace-nowrap z-50">
                                    {feedback}
                                </div>
                            )}

                            {phase === "intro" && (
                                <div className="text-center">
                                    <p className="text-gray-400 text-sm mb-3">{currentLevel.desc}</p>
                                    <button onClick={() => setPhase("skill")} className="w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-3 rounded-lg shadow-[0_4px_0_#1e3a8a] active:translate-y-1 active:shadow-none flex items-center justify-center gap-2 text-lg transition-all">
                                        {currentLevel.icon} ç™¼å‹•æŠ€èƒ½ï¼š{currentLevel.skill}
                                    </button>
                                </div>
                            )}

                            {phase === "skill" && (
                                <div className="animate-fade-in">
                                    <div className="text-blue-400 font-bold mb-2 flex items-center gap-2 text-sm">
                                        <Icons.Zap /> {currentEnemy.preQuestion}
                                    </div>
                                    <div className="grid grid-cols-1 gap-2">
                                        {currentEnemy.preOptions.map((opt, i) => (
                                            <button key={i} onClick={() => handleSkill(i)} className="bg-gray-700 hover:bg-gray-600 text-white py-3 px-4 rounded border border-gray-600 text-left font-bold active:bg-blue-900 transition-colors">
                                                {opt}
                                            </button>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {phase === "attack" && (
                                <div className="animate-fade-in">
                                    <div className="text-red-400 font-bold mb-2 flex items-center gap-2 text-sm">
                                        <Icons.Sword /> {currentEnemy.finalQuestion}
                                    </div>
                                    <div className="grid grid-cols-1 gap-2">
                                        {currentEnemy.options.map((opt, i) => (
                                            <button key={i} onClick={() => handleAttack(i)} className="bg-gray-700 hover:bg-gray-600 text-white py-3 px-4 rounded border border-gray-600 text-left active:bg-red-900 transition-colors flex">
                                                <span className="text-yellow-500 mr-2 font-bold">{String.fromCharCode(65+i)}.</span>
                                                {opt}
                                            </button>
                                        ))}
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<Game />);
    </script>
</body>
</html>
