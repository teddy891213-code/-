<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>åœ‹æ–‡ä¹å¼ãƒ»é™é­”ä¿®ç…‰è·¯</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;700;900&family=Zen+Maru+Gothic:wght@500;700&display=swap');
        
        body {
            font-family: 'Zen Maru Gothic', sans-serif;
            background-color: #1a1a1a;
            color: #e5e5e5;
            overscroll-behavior: none;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }
        
        .serif {
            font-family: 'Noto Serif TC', serif;
        }

        .text-shadow {
            text-shadow: 2px 2px 0px rgba(0,0,0,0.5);
        }

        /* æ¨¡æ“¬å·è»¸/å¤é¢¨æ•ˆæœ */
        .scroll-bg {
            background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%239C92AC' fill-opacity='0.05' fill-rule='evenodd'/%3E%3C/svg%3E");
        }

        .highlight-text {
            background-color: rgba(251, 191, 36, 0.3);
            color: #fbbf24;
            padding: 0 4px;
            border-radius: 4px;
            font-weight: bold;
        }

        .dim-text {
            opacity: 0.3;
            text-decoration: line-through;
        }

        .cut-mark {
            display: inline-block;
            width: 2px;
            height: 1.2em;
            background-color: #ef4444;
            margin: 0 4px;
            vertical-align: middle;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { opacity: 0.5; }
            50% { opacity: 1; }
            100% { opacity: 0.5; }
        }
    </style>
</head>
<body class="scroll-bg h-screen w-screen overflow-hidden">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const { motion, AnimatePresence } = window.Motion;
        const { Sword, Shield, Eye, PenTool, Activity, BarChart, XCircle, CheckCircle, ArrowRight, Zap, Scroll, BookOpen } = lucide;

        // --- éŠæˆ²è³‡æ–™åº« (Game Data) ---
        const LEVELS = [
            {
                id: 1,
                name: "ç¬¬ä¸€é—œï¼šè¿·éœ§æ£®æ—",
                skill: "æ…§çœ¼",
                skillIcon: Eye,
                desc: "å¿…å‹ç¬¬ä¸€å¼ï¼šç¯‡åå‘¼æ‡‰ã€‚å…ˆçœ‹ç¯‡åï¼Œé æ¸¬ä¸»æ—¨ï¼",
                color: "text-emerald-400",
                bgColor: "bg-emerald-900/50",
                enemies: [
                    {
                        name: "èŒ¶é¦™éœ§å¦–",
                        type: "å°æ€ª",
                        hp: 1,
                        source: "109å¹´æœƒè€ƒ",
                        title: "ã€ˆå–èŒ¶åŠ ä¸åŠ ç³–ï¼ŒåŸä¾†å’Œéšç´šæœ‰é—œã€‰",
                        content: "å–èŒ¶åŠ æª¸æª¬æ˜¯ç¾å¼ä½œæ³•...å‹å‹•éšç´šçš„é£²èŒ¶æ–¹å¼ï¼Œå‰‡æ˜¯ä»¥èŒ¶åŒ…æ²–æ³¡æ–¼é¦¬å…‹æ¯ä¸­å½¢æˆæ¿ƒèŒ¶å¾Œå†åŠ å…¥ç³–...",
                        skillEffect: "highlight",
                        skillTarget: ["å‹å‹•éšç´š", "æ¿ƒèŒ¶", "åŠ å…¥ç³–"],
                        preQuestion: "é€™ç¯‡æ–‡ç« çš„ä¸»æ—¨åœ¨è¬›ä»€éº¼ï¼Ÿ",
                        preOptions: ["èŒ¶è‘‰ç¨®æ¤", "éšç´šèˆ‡å–èŒ¶ç¿’æ…£"],
                        preAnswer: 1,
                        finalQuestion: "æ ¹æ“šæœ¬æ–‡ï¼Œæ˜”æ—¥è‹±åœ‹å‹å‹•éšç´šçš„å–èŒ¶æ–¹å¼ç‚ºä½•ï¼Ÿ",
                        options: ["ç“·å™¨ã€æ·¡èŒ¶ã€ä¸åŠ ç³–", "é¦¬å…‹æ¯ã€æ¿ƒèŒ¶ã€åŠ ç³–", "ç“·å™¨ã€æ¿ƒèŒ¶ã€åŠ ç³–", "é¦¬å…‹æ¯ã€æ·¡èŒ¶ã€ä¸åŠ ç³–"],
                        answer: 1 // index 1 is correct (Option B in paper is actually D in logic? text says Mark cup, strong tea, add sugar. Option 2 matches text)
                    },
                    {
                        name: "å›æ†¶æ¨¹ç²¾",
                        type: "èè‹±",
                        hp: 2,
                        source: "105å¹´æœƒè€ƒ",
                        title: "å‘é™½ã€ˆå°æ²³ã€‰",
                        content: "å°æ²³å‘¢ï¼Ÿé‚£å¿µå¿µä¸å¿˜çš„å°æ²³...ä¹¾ç™Ÿã€ç˜¦å‰Šï¼Œè€Œä¸”çœ‹ä¾†ç—›è‹¦...å †ç©è‘—ç ´éŠ…çˆ›éµï¼Œç´™å¼µåƒåœ¾...",
                        skillEffect: "highlight",
                        skillTarget: ["ä¹¾ç™Ÿã€ç˜¦å‰Š", "ç—›è‹¦", "å †ç©è‘—ç ´éŠ…çˆ›éµ"],
                        preQuestion: "é€™é¦–è©©çš„ä¸»è§’æ˜¯ï¼Ÿ",
                        preOptions: ["æŸå€‹äºº", "ä¸€æ¢æ²³"],
                        preAnswer: 1,
                        finalQuestion: "æ–‡ä¸­ç•«ç·šè™•ã€ä¹¾ç™Ÿã€ç˜¦å‰Šã€éš±å«ä»€éº¼å¿ƒæƒ…ï¼Ÿ",
                        options: ["é©šæ„•èˆ‡å¤±è½", "æ†¤æ€’èˆ‡ä»‡æ¨", "å¹³éœèˆ‡æ¥ç´", "èˆˆå¥®èˆ‡æœŸå¾…"],
                        answer: 0
                    },
                    {
                        name: "ç¦®æ•™çŸ³åƒ",
                        type: "BOSS",
                        hp: 3,
                        source: "110å¹´æœƒè€ƒ",
                        title: "å¸é¦¬å…‰ã€ˆç­”è–›è™Ÿå·è¬çŸ³æœˆå±æ›¸ã€‰",
                        content: "æ—¥å‰ä»¤éƒè¨ªé€®ï¼Œå‡ºæ‰‹ç­†ä¸¦çŸ³æœˆå±ç‚ºè´ˆ...æ¯”ä¾†ï¼Œæ•¸æ–¼éƒ½ä¸‹æœ‹å¾è™•è¦‹æ­¤å±...",
                        skillEffect: "highlight",
                        skillTarget: ["ç­”", "è¬", "ä»¤éƒ"],
                        preQuestion: "é€™ç¯‡æ–‡ç« çš„ç›®çš„æ˜¯ï¼Ÿ",
                        preOptions: ["è¨å‚µ", "ç­”è¬ç¦®ç‰©"],
                        preAnswer: 1,
                        finalQuestion: "æ–‡ä¸­ã€ä»¤éƒã€æ˜¯æŒ‡èª°ï¼Ÿ",
                        options: ["è–›è™Ÿå·çš„å…’å­", "å¸é¦¬å…‰çš„å…’å­", "çŸ³æœˆå±çš„ä½œè€…", "é€ç¦®çš„åƒ•äºº"],
                        answer: 0
                    }
                ]
            },
            {
                id: 2,
                name: "ç¬¬äºŒé—œï¼šæ–·å¥å³½è°·",
                skill: "æ–·å¥åˆ€",
                skillIcon: Sword,
                desc: "å¿…å‹ç¬¬äºŒå¼ï¼šæ¨™é»æ–·å¥ã€‚æ‰¾å‡ºèªæ°£è½‰æŠ˜èˆ‡çµæŸé»ï¼",
                color: "text-red-400",
                bgColor: "bg-red-900/50",
                enemies: [
                    {
                        name: "æ¨™é»å²èŠå§†",
                        type: "å°æ€ª",
                        hp: 1,
                        source: "111å¹´æœƒè€ƒ",
                        title: "è¨˜æ†¶èˆ‡æ•˜è¿°",
                        content: "æ•˜è¿°è¨˜æ†¶æ˜¯ä»¶é›£äº‹...å°±ç®—æ‹¼æ¹Šèµ·ä¾†äº†ä¹™ä¹Ÿåªç®—æ˜¯æ­»çš„æ¨™æœ¬...è¦æƒ³å°‡é¢¨ç‰‡åˆ‡ä¸‹ä¾†ï¼Œè±ˆä¸å®Œå…¨æ˜¯ä¸€å ´å¾’å‹å—ä¸",
                        skillEffect: "cut",
                        skillTarget: "ä¸",
                        preQuestion: "é€™æ®µè©±æœ€å¾Œæ˜¯ç”¨ä»€éº¼èªæ°£çµæŸï¼Ÿ",
                        preOptions: ["è‚¯å®šå¥", "åå•å¥"],
                        preAnswer: 1,
                        finalQuestion: "æ–‡ä¸­ç”²ä¹™ä¸™ä¸ä½•è™•æœ€é©åˆå¡«å…¥ã€å¥è™Ÿã€ï¼Ÿ",
                        options: ["ç”²", "ä¹™", "ä¸™", "ä¸"],
                        answer: 3
                    },
                    {
                        name: "æ†¤æ€’ç‹‚ç‰›",
                        type: "èè‹±",
                        hp: 2,
                        source: "107å¹´æœƒè€ƒ",
                        title: "æ†¤æ€’èˆ‡é…¸è…",
                        content: "æˆ‘å¯§é¡˜å»å“å˜—è¾›è¾£çš„æ†¤æ€’...å¯ä»¥ç—›å®šæ€ç—›ï¼Œæœ‰çŒ›çœçš„ä½œç”¨å”¯ç¨é…¸è…ï¼Œåªæœ‰é¤¿è‡­æ•—å£ä¸€é€”...",
                        skillEffect: "cut",
                        skillTarget: "å”¯ç¨",
                        preQuestion: "ã€å”¯ç¨ã€å‰é¢æ‡‰è©²ç”¨ä»€éº¼ç¬¦è™Ÿéš”é–‹æ’æ¯”å¥ï¼Ÿ",
                        preOptions: ["é€—è™Ÿ (,)", "åˆ†è™Ÿ (;)"],
                        preAnswer: 1,
                        finalQuestion: "æ–‡ä¸­ç¼ºç©ºè™•æ‡‰å¡«å…¥ä»€éº¼æ¨™é»ç¬¦è™Ÿï¼Ÿ",
                        options: ["ï¼Œ", "ï¼›", "ï¼", "ï¼š"],
                        answer: 1
                    },
                    {
                        name: "é›™é ­çµäºº",
                        type: "BOSS",
                        hp: 3,
                        source: "106å¹´æœƒè€ƒ",
                        title: "çµäººèˆ‡è¾²å¤«",
                        content: "ç¾åœ¨æ‰€è¬‚æ³¨æ„åŠ›ç¼ºå¤±è€…çš„ç‰¹å¾µâ€”â€”å®¹æ˜“åˆ†å¿ƒã€è¡å‹•ã€å†’éšªæ€§å¼·ï¼Œå…¶å¯¦æ˜¯é å¤æ‰“çµæ¡é›†æ™‚ç”Ÿå­˜å¿…è¦çš„ç‰¹å¾µã€‚",
                        skillEffect: "highlight",
                        skillTarget: ["â€”â€”", "ç‰¹å¾µ"],
                        preQuestion: "ç ´æŠ˜è™Ÿåœ¨æ­¤è™•çš„åŠŸèƒ½æ˜¯ï¼Ÿ",
                        preOptions: ["è²éŸ³å»¶é•·", "è§£é‡‹èªªæ˜"],
                        preAnswer: 1,
                        finalQuestion: "ä½œè€…å°ADHDè€…çš„çœ‹æ³•ç‚ºä½•ï¼Ÿ",
                        options: ["æ‡‰æ¥å—æ²»ç™‚", "ä¸å®œä»¥ç•°é¡çœ¼å…‰çœ‹å¾…", "åŸºå› æ¯”å¸¸äººå„ªç§€", "æ˜¯ç¤¾æœƒçš„è² æ“”"],
                        answer: 1
                    }
                ]
            },
            {
                id: 3,
                name: "ç¬¬ä¸‰é—œï¼šé‚è¼¯è¿·å®®",
                skill: "è½‰æŠ˜ç›¾",
                skillIcon: Shield,
                desc: "å¿…å‹ç¬¬ä¸‰å¼ï¼šé‚è¼¯å­—è©ã€‚æ“‹æ‰å»¢è©±ï¼Œç•™ä¸‹é‡é»ï¼",
                color: "text-blue-400",
                bgColor: "bg-blue-900/50",
                enemies: [
                    {
                        name: "æ²¸æ°´æ€ª",
                        type: "å°æ€ª",
                        hp: 1,
                        source: "105å¹´æœƒè€ƒ",
                        title: "æšæ¹¯æ­¢æ²¸",
                        content: "å¤«æŠ•è† ä»¥è®Šæ¿ï¼Œä¸å¦‚æ¾„å…¶æº...æšæ¹¯ä»¥æ­¢æ²¸ï¼Œä¸å¦‚çµ•å…¶è–ªè€Œæ²¸æ­¢ä¹‹é€Ÿä¹Ÿã€‚",
                        skillEffect: "dim",
                        skillTarget: ["æšæ¹¯ä»¥æ­¢æ²¸"],
                        preQuestion: "ã€ä¸å¦‚ã€è¡¨ç¤ºé‡é»åœ¨å¾Œå¥ï¼Œå¾Œå¥å¼·èª¿ä»€éº¼ï¼Ÿ",
                        preOptions: ["æ²»æ¨™", "æ²»æœ¬"],
                        preAnswer: 1,
                        finalQuestion: "ä¸‹åˆ—ä½•è€…æœ€ç¬¦åˆä½œè€…è§€é»ï¼Ÿ",
                        options: ["æšæ¹¯æ­¢æ²¸", "æŠ•è† è®Šæ¿", "çµ•è–ªæ­¢æ²¸", "å¤šæ–¹æ•‘å¤±"],
                        answer: 2
                    },
                    {
                        name: "é›»å½±å¹»è¡“å¸«",
                        type: "èè‹±",
                        hp: 2,
                        source: "107å¹´æœƒè€ƒ",
                        title: "é›»å½±è—åœ–",
                        content: "åŠªåŠ›ç ”ç™¼èºçµ²é‡˜ï¼Œé›–ç„¶é€™ä¹Ÿå¾ˆé‡è¦ï¼Œä½†å…ˆæœ‰è—åœ–ï¼Œç­‰æ•´å€‹å¸‚å ´æœ‰èµ·è‰²å¾Œï¼Œå†å»æ‰¶æ¤ï¼ŒåŠ›é‡æ‰æœƒæ›´å¤§ã€‚",
                        skillEffect: "dim",
                        skillTarget: ["åŠªåŠ›ç ”ç™¼èºçµ²é‡˜", "é›–ç„¶é€™ä¹Ÿå¾ˆé‡è¦"],
                        preQuestion: "ã€ä½†ã€å­—å‡ºç¾ï¼Œé‡é»åœ¨å“ªè£¡ï¼Ÿ",
                        preOptions: ["å‰é¢çš„èºçµ²é‡˜", "å¾Œé¢çš„è—åœ–"],
                        preAnswer: 1,
                        finalQuestion: "é€™æ®µæ–‡å­—å¼·èª¿é›»å½±ç”¢æ¥­ç™¼å±•çš„æ ¹æœ¬æ˜¯ä»€éº¼ï¼Ÿ",
                        options: ["å¥½çš„åŠ‡æœ¬å’Œè£½ä½œæ¡ˆ(è—åœ–)", "å¥½çš„ç‰¹æ•ˆ(èºçµ²é‡˜)", "é¾å¤§çš„è³‡é‡‘", "çŸ¥åæ¼”å“¡"],
                        answer: 0
                    },
                    {
                        name: "æ·±å½é­”ç‹",
                        type: "BOSS",
                        hp: 3,
                        source: "113å¹´æœƒè€ƒ",
                        title: "æ·±å½æŠ€è¡“",
                        content: "è‹¥å°‡å®ƒé‹ç”¨æ–¼å½±è¦–ä½œå“...æœ‰æ­£é¢çš„æ•ˆç›Šã€‚ä½†ä¹Ÿæœ‰äººåˆ©ç”¨åˆæˆçš„å‡å½±åƒæ“å¼„è³‡è¨Šï¼Œé€²è€Œè©é¨™ç‰Ÿåˆ©...",
                        skillEffect: "dim",
                        skillTarget: ["æœ‰æ­£é¢çš„æ•ˆç›Š"],
                        preQuestion: "ä½œè€…æƒ³å¼·èª¿æ·±å½æŠ€è¡“çš„å“ªä¸€é¢ï¼Ÿ",
                        preOptions: ["æ­£é¢æ•ˆç›Š", "è² é¢çˆ­è­°"],
                        preAnswer: 1,
                        finalQuestion: "æ ¹æ“šæœ¬æ–‡ï¼Œæ·±å½æŠ€è¡“æœ€å¤§çš„éš±æ†‚æ˜¯ä»€éº¼ï¼Ÿ",
                        options: ["æˆæœ¬éé«˜", "å–ä»£æ¼”å“¡å·¥ä½œ", "é€ æˆæ°‘çœ¾å°ç¤¾æœƒçš„ä¸ä¿¡ä»»", "æŠ€è¡“é–€æª»å¤ªä½"],
                        answer: 2
                    }
                ]
            },
            {
                id: 4,
                name: "ç¬¬å››é—œï¼šæ•¸æ“šé«˜å¡”",
                skill: "é·¹çœ¼",
                skillIcon: BarChart,
                desc: "å¿…å‹ç¬¬å››å¼ï¼šåœ–è¡¨åˆ¤è®€ã€‚å®šé¡å‹ã€æ‰¾æ¥µå€¼ï¼",
                color: "text-purple-400",
                bgColor: "bg-purple-900/50",
                enemies: [
                    {
                        name: "èƒŒåŒ…æ–¹å¡Š",
                        type: "å°æ€ª",
                        hp: 1,
                        source: "105å¹´æœƒè€ƒ",
                        title: "èƒŒåŒ…èˆ‡å¥åº·",
                        content: "åœ–è¡¨é¡¯ç¤ºï¼šé«”é‡60å…¬æ–¤è€…ï¼Œå»ºè­°èƒŒåŒ…é‡é‡6kgä»¥ä¸‹ï¼ŒèƒŒå¸¶è¦çŸ­ä¸”è²¼èƒŒã€‚",
                        skillEffect: "highlight",
                        skillTarget: ["60å…¬æ–¤", "èƒŒå¸¶çŸ­", "è²¼èƒŒ"],
                        preQuestion: "é«”é‡60å…¬æ–¤çš„äººï¼ŒèƒŒåŒ…æ‡‰è©²æ€éº¼èƒŒï¼Ÿ",
                        preOptions: ["èƒŒå¸¶é•·ï¼Œé›¢èº«é«”é ", "èƒŒå¸¶çŸ­ï¼Œè²¼è¿‘èº«é«”"],
                        preAnswer: 1,
                        finalQuestion: "å“ªä¸€å€‹åœ–ç¤ºç¬¦åˆå¥åº·èƒŒæ³•ï¼Ÿ",
                        options: ["èƒŒå¸¶å¾ˆé•·å‚åˆ°å±è‚¡", "èƒŒå¸¶çŸ­ï¼ŒèƒŒåŒ…è²¼èƒŒ", "å´èƒŒä¸”å¾ˆé‡", "æ‰‹æ"],
                        answer: 1
                    },
                    {
                        name: "äººå£é•·æ¢æ€ª",
                        type: "èè‹±",
                        hp: 2,
                        source: "110å¹´æœƒè€ƒ",
                        title: "æ–°ä½æ°‘å­å¥³çµ±è¨ˆ",
                        content: "é•·æ¢åœ–é¡¯ç¤ºï¼šéæ–°ä½æ°‘å­å¥³(ç¶²é»é•·æ¢)é€å¹´ä¸‹é™ã€‚åœ‹å°æ–°ä½æ°‘å­å¥³(æ·ºè‰²é•·æ¢)æŒå¹³æˆ–å¾®é™ã€‚",
                        skillEffect: "highlight",
                        skillTarget: ["é€å¹´ä¸‹é™", "æŒå¹³"],
                        preQuestion: "æˆ‘å€‘è¦æ‰¾ã€éŒ¯èª¤ã€çš„æ•˜è¿°ï¼Œé¦–å…ˆè§€å¯Ÿç¶²é»é•·æ¢çš„è¶¨å‹¢æ˜¯ï¼Ÿ",
                        preOptions: ["ä¸Šå‡", "ä¸‹é™"],
                        preAnswer: 1,
                        finalQuestion: "æ ¹æ“šåœ–è¡¨ï¼Œä¸‹åˆ—æ•˜è¿°ä½•è€…éŒ¯èª¤ï¼Ÿ",
                        options: ["åœ‹ä¸­å°å­¸ç”Ÿç¸½äººæ•¸ä¸‹é™", "åœ‹å°æ–°ä½æ°‘å­å¥³äººæ•¸å¤§å¹…ä¸Šå‡", "åœ‹ä¸­æ–°ä½æ°‘å­å¥³æ¯”ä¾‹ä¸Šå‡", "éæ–°ä½æ°‘å­å¥³æ¯”ä¾‹ä¸‹é™"],
                        answer: 1
                    },
                    {
                        name: "ç¶“è²»å·¨åƒ",
                        type: "BOSS",
                        hp: 3,
                        source: "107å¹´æœƒè€ƒ",
                        title: "å„åœ‹æ•™è‚²ç¶“è²»",
                        content: "é•·æ¢åœ–é¡¯ç¤ºï¼šä¸åœ‹çš„é«˜ä¸­ç”Ÿ(æ·±è‰²é•·æ¢)ç¶“è²»æŸ±å­æ˜¯æ‰€æœ‰åœ‹å®¶ä¸­æœ€é«˜çš„ã€‚",
                        skillEffect: "highlight",
                        skillTarget: ["ä¸åœ‹", "é«˜ä¸­", "æœ€é«˜"],
                        preQuestion: "æ¯”è¼ƒå„åœ‹æŸ±å­é«˜åº¦ï¼Œå“ªä¸€åœ‹çš„é«˜ä¸­ç¶“è²»æœ€é«˜ï¼Ÿ",
                        preOptions: ["ç”²åœ‹", "ä¸åœ‹"],
                        preAnswer: 1,
                        finalQuestion: "æ ¹æ“šåœ–è¡¨ï¼Œä¸‹åˆ—æ•˜è¿°ä½•è€…æ­£ç¢ºï¼Ÿ",
                        options: ["ç”²åœ‹å°å­¸ç”Ÿç¶“è²»æœ€é«˜", "ä¸™åœ‹åœ‹ä¸­ç”Ÿç¶“è²»æœ€é«˜", "å„åœ‹é«˜ç­‰æ•™è‚²ç¶“è²»éƒ½æœ€å¤š", "ä¸åœ‹é«˜ä¸­ç”Ÿç¶“è²»æœ€é«˜"],
                        answer: 3
                    }
                ]
            }
        ];

        // --- çµ„ä»¶ (Components) ---

        const ProgressBar = ({ current, total }) => (
            <div className="w-full bg-gray-700 h-2 rounded-full mb-4 overflow-hidden">
                <motion.div 
                    className="h-full bg-yellow-500"
                    initial={{ width: 0 }}
                    animate={{ width: `${(current / total) * 100}%` }}
                />
            </div>
        );

        const Typewriter = ({ text, onComplete }) => {
            const [display, setDisplay] = useState("");
            
            useEffect(() => {
                let i = 0;
                const timer = setInterval(() => {
                    if (i < text.length) {
                        setDisplay(prev => prev + text.charAt(i));
                        i++;
                    } else {
                        clearInterval(timer);
                        if(onComplete) onComplete();
                    }
                }, 30);
                return () => clearInterval(timer);
            }, [text]);

            return <div className="text-lg leading-relaxed">{display}</div>;
        };

        const MainMenu = ({ onStart }) => (
            <div className="flex flex-col items-center justify-center h-full p-6 text-center space-y-8 relative z-10">
                <motion.div
                    initial={{ opacity: 0, y: -20 }}
                    animate={{ opacity: 1, y: 0 }}
                    transition={{ duration: 1 }}
                >
                    <div className="text-yellow-500 text-xl mb-2 font-bold tracking-widest">åœ‹æ–‡æœƒè€ƒç‰¹è¨“</div>
                    <h1 className="text-5xl md:text-6xl font-black text-white text-shadow serif mb-2">åœ‹æ–‡ä¹å¼</h1>
                    <h2 className="text-3xl md:text-4xl font-bold text-red-500 text-shadow serif">é™é­”ä¿®ç…‰è·¯</h2>
                </motion.div>

                <motion.div 
                    className="grid grid-cols-2 gap-4 w-full max-w-md"
                    initial={{ opacity: 0 }}
                    animate={{ opacity: 1 }}
                    transition={{ delay: 0.5 }}
                >
                    {LEVELS.map((level, idx) => (
                        <div key={idx} className={`p-4 rounded-lg border-2 border-opacity-30 ${level.color.replace('text', 'border')} bg-gray-800 bg-opacity-80`}>
                            <div className={`text-2xl mb-2 ${level.color}`}>
                                {React.createElement(level.skillIcon)}
                            </div>
                            <div className="font-bold text-sm">{level.name}</div>
                            <div className="text-xs text-gray-400 mt-1">{level.skill}</div>
                        </div>
                    ))}
                </motion.div>

                <motion.button
                    whileHover={{ scale: 1.05 }}
                    whileTap={{ scale: 0.95 }}
                    onClick={onStart}
                    className="bg-red-600 text-white px-12 py-4 rounded-full text-xl font-bold shadow-lg shadow-red-900/50 border-2 border-red-400 flex items-center gap-2"
                >
                    <Zap className="w-6 h-6" /> é–‹å§‹ä¿®ç…‰
                </motion.button>
                
                <div className="absolute bottom-4 text-xs text-gray-500">
                    Based on 105-113 CAP Chinese Exam Questions
                </div>
            </div>
        );

        const BattleScene = ({ levelData, roundData, onWin, onLose }) => {
            const [phase, setPhase] = useState("intro"); // intro, pre-skill, skill-check, final, result
            const [processedContent, setProcessedContent] = useState(roundData.content);
            const [feedback, setFeedback] = useState("");
            
            // Effect to reset state when round changes
            useEffect(() => {
                setPhase("intro");
                setProcessedContent(roundData.content);
                setFeedback("");
            }, [roundData]);

            const handleSkillUse = () => {
                setPhase("skill-check");
            };

            const handlePreAnswer = (index) => {
                if (index === roundData.preAnswer) {
                    // Correct Pre-answer: Apply Skill Effect
                    if (roundData.skillEffect === "highlight") {
                        let newContent = roundData.content;
                        roundData.skillTarget.forEach(target => {
                            newContent = newContent.replace(new RegExp(target, 'g'), `<span class="highlight-text">${target}</span>`);
                        });
                        setProcessedContent(newContent);
                    } else if (roundData.skillEffect === "cut") {
                        const parts = roundData.content.split(roundData.skillTarget);
                        setProcessedContent(`${parts[0]}<span class="cut-mark"></span>${roundData.skillTarget}${parts[1]}`);
                    } else if (roundData.skillEffect === "dim") {
                        let newContent = roundData.content;
                        roundData.skillTarget.forEach(target => {
                            newContent = newContent.replace(new RegExp(target, 'g'), `<span class="dim-text">${target}</span>`);
                        });
                        setProcessedContent(newContent);
                    }
                    
                    setFeedback("æŠ€èƒ½ç™¼å‹•æˆåŠŸï¼ç ´ç¶»å·²ç¾ï¼");
                    setTimeout(() => {
                        setPhase("final");
                        setFeedback("");
                    }, 1500);
                } else {
                    // Wrong Pre-answer
                    setFeedback("é åˆ¤éŒ¯èª¤ï¼å—åˆ°åæ“Šï¼");
                    setTimeout(() => onLose(), 1000);
                }
            };

            const handleFinalAnswer = (index) => {
                if (index === roundData.answer) {
                    setFeedback("æœƒå¿ƒä¸€æ“Šï¼");
                    setPhase("result");
                    setTimeout(onWin, 1500);
                } else {
                    setFeedback("æ”»æ“Šè¢«æ ¼æ“‹äº†ï¼");
                    setTimeout(onLose, 1000);
                }
            };

            return (
                <div className="h-full flex flex-col p-4 relative max-w-2xl mx-auto">
                    {/* Header */}
                    <div className="flex justify-between items-center mb-4 bg-black/40 p-2 rounded-lg">
                        <div>
                            <div className="text-xs text-gray-400">{levelData.name}</div>
                            <div className="font-bold text-yellow-500">{roundData.name} <span className="text-xs text-gray-400">({roundData.type})</span></div>
                        </div>
                        <div className="text-xs bg-gray-700 px-2 py-1 rounded">ä¾†æºï¼š{roundData.source}</div>
                    </div>

                    {/* Enemy Visual */}
                    <div className="flex-1 flex flex-col items-center justify-center mb-4">
                        <motion.div 
                            className={`w-32 h-32 rounded-full flex items-center justify-center text-4xl border-4 ${phase === 'intro' ? 'border-gray-500' : 'border-red-500'}`}
                            animate={phase === 'skill-check' || phase === 'final' ? { scale: [1, 1.1, 1], rotate: [0, 5, -5, 0] } : {}}
                            transition={{ duration: 0.5 }}
                        >
                            {levelData.id === 1 ? "ğŸŒ«ï¸" : levelData.id === 2 ? "ğŸ" : levelData.id === 3 ? "ğŸ‚" : "ğŸ“Š"}
                        </motion.div>
                        <div className="mt-4 bg-gray-800/80 p-4 rounded-lg border border-gray-600 w-full min-h-[100px]">
                            <div className="text-yellow-400 text-sm font-bold mb-1">
                                {levelData.id === 1 ? "ã€ç¯‡åã€‘" : "ã€åŸæ–‡/åœ–è¡¨ã€‘"} {roundData.title}
                            </div>
                            <div 
                                className="text-lg leading-relaxed"
                                dangerouslySetInnerHTML={{ __html: processedContent }} 
                            />
                        </div>
                    </div>

                    {/* Interaction Area */}
                    <div className="bg-gray-900/90 rounded-t-2xl p-6 border-t-2 border-yellow-600 shadow-[0_-4px_20px_rgba(0,0,0,0.5)]">
                        
                        <AnimatePresence mode="wait">
                            {phase === "intro" && (
                                <motion.div
                                    key="intro"
                                    initial={{ opacity: 0, y: 20 }}
                                    animate={{ opacity: 1, y: 0 }}
                                    exit={{ opacity: 0, y: -20 }}
                                    className="text-center"
                                >
                                    <p className="mb-4 text-gray-300">{levelData.desc}</p>
                                    <button 
                                        onClick={() => setPhase("pre-skill")}
                                        className="w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-3 px-6 rounded-lg flex items-center justify-center gap-2"
                                    >
                                        <BookOpen className="w-5 h-5" /> è§€å¯Ÿæ•µæƒ…
                                    </button>
                                </motion.div>
                            )}

                            {phase === "pre-skill" && (
                                <motion.div
                                    key="pre-skill"
                                    initial={{ opacity: 0, y: 20 }}
                                    animate={{ opacity: 1, y: 0 }}
                                    exit={{ opacity: 0, y: -20 }}
                                >
                                    <div className="flex items-center gap-2 mb-4 text-yellow-400 font-bold">
                                        {React.createElement(levelData.skillIcon, { className: "w-5 h-5" })}
                                        ç™¼å‹•æŠ€èƒ½ï¼š{levelData.skill}
                                    </div>
                                    <p className="mb-4 text-lg font-bold">{roundData.preQuestion}</p>
                                    <div className="grid grid-cols-1 gap-3">
                                        {roundData.preOptions.map((opt, idx) => (
                                            <button
                                                key={idx}
                                                onClick={() => handlePreAnswer(idx)}
                                                className="bg-gray-700 hover:bg-gray-600 p-3 rounded text-left border border-gray-600"
                                            >
                                                {opt}
                                            </button>
                                        ))}
                                    </div>
                                </motion.div>
                            )}

                            {phase === "final" && (
                                <motion.div
                                    key="final"
                                    initial={{ opacity: 0, y: 20 }}
                                    animate={{ opacity: 1, y: 0 }}
                                    exit={{ opacity: 0, y: -20 }}
                                >
                                    <div className="flex items-center gap-2 mb-4 text-red-400 font-bold">
                                        <Sword className="w-5 h-5" /> çµ‚çµä¸€æ“Š
                                    </div>
                                    <p className="mb-4 text-lg font-bold">{roundData.finalQuestion}</p>
                                    <div className="grid grid-cols-1 gap-3">
                                        {roundData.options.map((opt, idx) => (
                                            <button
                                                key={idx}
                                                onClick={() => handleFinalAnswer(idx)}
                                                className="bg-gray-700 hover:bg-gray-600 p-3 rounded text-left border border-gray-600 active:bg-yellow-600 transition-colors"
                                            >
                                                <span className="font-bold mr-2 text-yellow-500">
                                                    {String.fromCharCode(65 + idx)}.
                                                </span>
                                                {opt}
                                            </button>
                                        ))}
                                    </div>
                                </motion.div>
                            )}

                            {feedback && (
                                <motion.div 
                                    className="absolute top-0 left-0 w-full h-full flex items-center justify-center bg-black/80 rounded-t-2xl z-20"
                                    initial={{ opacity: 0 }}
                                    animate={{ opacity: 1 }}
                                >
                                    <div className="text-2xl font-bold text-white text-center">
                                        {feedback}
                                    </div>
                                </motion.div>
                            )}
                        </AnimatePresence>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [gameState, setGameState] = useState("menu"); // menu, playing, gameover, victory
            const [currentLevelIdx, setCurrentLevelIdx] = useState(0);
            const [currentRoundIdx, setCurrentRoundIdx] = useState(0);
            const [lives, setLives] = useState(3);

            const startLevel = () => {
                setGameState("playing");
            };

            const handleWinRound = () => {
                if (currentRoundIdx < LEVELS[currentLevelIdx].enemies.length - 1) {
                    setCurrentRoundIdx(prev => prev + 1);
                } else {
                    if (currentLevelIdx < LEVELS.length - 1) {
                        setCurrentLevelIdx(prev => prev + 1);
                        setCurrentRoundIdx(0);
                    } else {
                        setGameState("victory");
                    }
                }
            };

            const handleLoseRound = () => {
                if (lives > 1) {
                    setLives(prev => prev - 1);
                    // Shake effect could be added here
                } else {
                    setGameState("gameover");
                }
            };

            const resetGame = () => {
                setGameState("menu");
                setCurrentLevelIdx(0);
                setCurrentRoundIdx(0);
                setLives(3);
            };

            if (gameState === "menu") return <MainMenu onStart={startLevel} />;

            if (gameState === "victory") return (
                <div className="h-full flex flex-col items-center justify-center p-6 text-center bg-yellow-900/20">
                    <div className="text-6xl mb-4">ğŸ†</div>
                    <h1 className="text-4xl font-bold text-yellow-400 mb-4 text-shadow">ä¿®ç…‰å®Œæˆï¼</h1>
                    <p className="text-xl mb-8">ä½ å·²æŒæ¡åœ‹æ–‡ä¹å¼ï¼Œæœƒè€ƒé™é­”ç„¡å¾€ä¸åˆ©ï¼</p>
                    <button onClick={resetGame} className="bg-yellow-600 px-8 py-3 rounded-full font-bold">å†ä¾†ä¸€å±€</button>
                </div>
            );

            if (gameState === "gameover") return (
                <div className="h-full flex flex-col items-center justify-center p-6 text-center bg-red-900/20">
                    <div className="text-6xl mb-4">ğŸ’€</div>
                    <h1 className="text-4xl font-bold text-red-500 mb-4 text-shadow">ä¿®ç…‰å¤±æ•—</h1>
                    <p className="text-xl mb-8">å‹æ•—ä¹ƒå…µå®¶å¸¸äº‹ï¼Œå¤§ä¿ è«‹é‡æ–°ä¾†éã€‚</p>
                    <button onClick={resetGame} className="bg-gray-600 px-8 py-3 rounded-full font-bold">é‡æ–°æŒ‘æˆ°</button>
                </div>
            );

            const currentLevel = LEVELS[currentLevelIdx];
            const currentRound = currentLevel.enemies[currentRoundIdx];

            return (
                <div className="h-full flex flex-col">
                    {/* Top Bar */}
                    <div className="p-4 flex justify-between items-center bg-black/30 backdrop-blur-sm z-10">
                        <div className="flex items-center gap-2">
                            <div className="bg-red-900 p-2 rounded-full border border-red-500">
                                <Activity className="w-4 h-4 text-red-400" />
                            </div>
                            <div className="flex gap-1">
                                {[...Array(3)].map((_, i) => (
                                    <div key={i} className={`w-8 h-2 rounded-full ${i < lives ? 'bg-green-500' : 'bg-gray-700'}`} />
                                ))}
                            </div>
                        </div>
                        <div className="font-bold text-sm text-gray-400">
                            é—œå¡ {currentLevelIdx + 1}-{currentRoundIdx + 1}
                        </div>
                    </div>

                    <BattleScene 
                        levelData={currentLevel}
                        roundData={currentRound}
                        onWin={handleWinRound}
                        onLose={handleLoseRound}
                    />
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
